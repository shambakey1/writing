try{var iErrs=0;var iProtocol=document.location.toString().indexOf("https")!=-1?"https":"http";var THPageID=document.getElementById("PageID");if(THPageID){THPageID=THPageID.title}else{var Comments=document.getElementsByTagName("COMMENT");for(i=0;i<Comments.length;i++){if(Comments.item(i).title.indexOf("HTX")==0){THPageID=Comments.item(i).title;break}}}function LogError(Description){if(iErrs==0){var ErrImage=new Image(1,1);ErrImage.src=iProtocol+"://"+th_domain+"/Offers/Delivery/ErrorFound.aspx?page=FlightDetailsScrape&Title="+document.title+"&desc="+Description+"&pgID="+THPageID;iErrs++}}function THGetEAPID(){var r="";try{var Start=document.body.innerHTML.indexOf("EAPID=",0);if(Start==-1){return""}var End=document.body.innerHTML.indexOf("&",Start);if(End==-1){return""}var r=document.body.innerHTML.substring(Start+6,End)}catch(er){LogError("EAPIDError")}return r}function THGetDepAirport(TR){var r="";try{var s=TR.innerHTML;var Start=s.indexOf("(",0);var End=s.indexOf(")",Start);if(Start!=-1&&End!=-1){r=s.substring(Start+1,End)}return r}catch(er){LogError("DepAirport:"+er)}}function THGetDesAirport(TR){var r="";try{if(document.getElementById("TravelHookDest")){return document.getElementById("TravelHookDest").getAttribute("value")}var Newr="";var s=TR.innerHTML;var Start=s.indexOf("(",0);Start=s.indexOf("(",Start+1);var End=s.indexOf(")",Start);if(Start!=-1&&End!=-1){r=s.substring(Start+1,End)}var iLegs=0;var bSections=false;var Rows=TR.getElementsByTagName("TR");for(i=0;i<Rows.length;i++){var s=Rows.item(i).innerHTML;if(i==0&&(s.indexOf("Traveling to")!=-1||s.indexOf("Travelling to")!=-1)){bSections=true}if(((s.indexOf("alt=flight")!=-1||s.indexOf('alt="flight"')!=-1)&&!bSections)||(s.indexOf("Traveling to")!=-1||s.indexOf("Travelling to")!=-1)){iLegs++}if(iLegs==2){break}var Start=s.indexOf("(",0);Start=s.indexOf("(",Start+1);var End=s.indexOf(")",Start);if(Start!=-1&&End!=-1&&(End-Start==4)){Newr=s.substring(Start+1,End)}}if(Newr!=""){r=Newr}return r}catch(er){LogError("DesAirport:"+er)}}function THGetAirline(TR){var r="";try{var Images=TR.getElementsByTagName("IMG");if(Images.length>1){var Image=Images.item(1);var End=Image.src.indexOf(".gif",0);if(End==-1){End=Image.src.indexOf(".jpg",0)}if(End==-1){End=Image.src.indexOf(".GIF",0)}if(End==-1){End=Image.src.indexOf(".JPG",0)}if(End!=-1){r=Image.src.substring(End-2,End)}}var bSame=true;Images=document.getElementsByTagName("IMG");for(var x=0;x<Images.length;x++){if(Images.item(x).src){if(Images.item(x).src.indexOf("/pubspec/images/airlines/")!=-1){var Image=Images.item(x);var End=Image.src.indexOf(".gif",0);if(End==-1){End=Image.src.indexOf(".jpg",0)}if(End!=-1){var newA=Image.src.substring(End-2,End);if(newA!=r){bSame=false;break}}}}}if(bSame){r+="&AL2=S"}else{r+="&AL2=D"}return r}catch(er){LogError("Airline:"+er)}}function THGetDate(TR){var r="";try{r=document.getElementById("PriceSummary_FlightDate_0").innerHTML;return r}catch(er){LogError("Date:"+er)}}function THGetReturnDate(){var r="";try{var retDateEl=document.getElementById("PriceSummary_FlightDate_1");if(retDateEl!=null){r=retDateEl.innerHTML}return r}catch(er){LogError("ReturnDate:"+er)}}function THGetFlightNum(TR){var r="NO=";var Direction=0;try{var Cells=TR.getElementsByTagName("TD");for(var i=0;i<Cells.length;i++){var s=Cells.item(i).innerHTML;if(s.indexOf("Flight:",0)!=-1||s.indexOf("Vol",0)!=-1||s.indexOf("Vol&nbsp;:",0)!=-1||s.indexOf("Flug:",0)!=-1||s.indexOf("Flug",0)!=-1||s.indexOf("Volo:",0)!=-1){if(Cells.item(i).getAttribute("id")!="A5006_12715"){continue}var Airline=Cells.item(i).getElementsByTagName("SPAN")[0].innerHTML.substring(0,2);if(s.indexOf("flightnumber")==-1){var stIdx=s.indexOf("Flight:",0);if(stIdx==-1){stIdx=s.indexOf("Vol&nbsp;:",0)}if(stIdx==-1){stIdx=s.indexOf("Vol :",0)}if(stIdx==-1){stIdx=s.indexOf("Flug:",0)}if(stIdx==-1){stIdx=s.indexOf("Volo:",0)}var Start=stIdx+11;var End=s.indexOf("</B>",Start);if(End==-1){End=s.indexOf("</b>",Start)}if(End!=-1){s=s.substring(Start,End)}if(s.indexOf("</a>",0)!=-1||s.indexOf("</A>",0)!=-1){Start=s.indexOf(">",0);End=s.indexOf("</",0);if(Start!=-1&&End!=-1){s=s.substring(Start+1,End)}}r+=Airline+s+","}else{var Spans=Cells.item(i).getElementsByTagName("SPAN");for(var j=0;j<Spans.length;j++){if(Spans[j].id=="flightnumber"){r+=Airline+Spans[j].innerHTML+",";break}}}}if((s.indexOf("Total duration:")!=-1||s.indexOf(" totale :")!=-1||s.indexOf("Durée totale")!=-1||s.indexOf("Durï¿½e totale :")!=-1||s.indexOf("Gesamtdauer:")!=-1||s.indexOf("Durata totale:")!=-1)&&Direction==0){if(r.substring(r.length-1,r.length)==","){r=r.substring(0,r.length-1)}r+="&NR=";Direction=1}}if(r.substring(r.length-4,r.length)=="&NR="){r=r.substring(0,r.length-4)}if(r.substring(r.length-1,r.length)==","){r=r.substring(0,r.length-1)}return r}catch(er){LogError("FlightNum:"+er)}}function THGetTravelerCount(){var r=1;try{var Adults=0;var Children=0;var Seniors=0;var Infants=0;if(document.getElementById("CAdu")){Adults=parseInt(document.getElementById("CAdu").getAttribute("title"))}if(document.getElementById("CSen")){Seniors=parseInt(document.getElementById("CSen").getAttribute("title"))}if(document.getElementById("CChi")){Children=parseInt(document.getElementById("CChi").getAttribute("title"))}if(document.getElementById("CIns")){Infants=parseInt(document.getElementById("CIns").getAttribute("title"))}r=Adults+Children+Seniors+Infants;if(r==0){var Left=document.getElementById("Nav2Bar");var Coms=Left.getElementsByTagName("COMMENT");var Top=Coms.length;if(Left.innerHTML.indexOf("(lap)")!=-1){Top-=1}for(var x=0;x<Top;x++){r+=parseInt(Coms.item(x).getAttribute("title"))}}}catch(er){LogError("NoTravelers")}return r}function THGetTravelers(){var r="";if(document.getElementById("CAdu")){r+="pa="+document.getElementById("CAdu").getAttribute("title")+"&"}if(document.getElementById("CSen")){r+="ps="+document.getElementById("CSen").getAttribute("title")+"&"}if(document.getElementById("CChi")){r+="pc="+document.getElementById("CChi").getAttribute("title")+"&"}if(document.getElementById("CIns")){r+="pis="+document.getElementById("CIns").getAttribute("title")+"&"}if(document.getElementById("CInf")){r+="pil="+document.getElementById("CInf").getAttribute("title")+"&"}return r}function THGetHotelIDs(){var r="";try{var tags=document.getElementsByTagName("A");var sHotelIDs=",";var iHotels=0;var iTravelers=THGetTravelerCount();for(var i=0;i<tags.length;i++){if(tags.item(i).href.indexOf("HI")!=-1){var Text=tags.item(i).href;var Start=Text.indexOf("HI",0);Start+=3;var End=Text.indexOf(",",Start);if(End!=-1){var HID=Text.substring(Start,End);if(sHotelIDs.indexOf(","+HID+",")==-1){r+="H"+iHotels+"="+HID+"&";sHotelIDs+=HID+",";try{var Row=tags.item(i);while(Row.nodeName!="TBODY"){Row=Row.parentNode}while(Row.nodeName!="TR"){Row=Row.parentNode}Row=Row.nextSibling;while(Row.nodeName!="TR"){Row=Row.nextSibling}Row=Row.getElementsByTagName("FONT");for(var x=0;x<Row.length;x++){if(Row.item(x).className=="smallTxt"&&Row.item(x).innerHTML.indexOf("$")!=-1){var End=Row.item(x).innerHTML.indexOf("&");if(End==-1){End=Row.item(x).innerHTML.indexOf(unescape("%A0"))}var s=Row.item(x).innerHTML.substring(0,End);if(location.hostname.indexOf("expedia.fr")!=-1||location.hostname.indexOf("expedia.de")!=-1||location.hostname.indexOf("expedia.it")!=-1){s=s.replace(".","");r=r.replace(",",".")}else{s=s.replace(",","")}var Price=s.replace("$","").replace("£").replace("€","").replace(" ","");Price=Price*iTravelers;r+="P"+iHotels+"="+Price+"&"}}}catch(er){}iHotels++}}}}}catch(er){}return r}function ScrapeFlight(){try{var Anchor1=document.getElementById("FSP");var Anchor2;if(Anchor1){Anchor1=Anchor1.parentNode}if(Anchor1){if(Anchor1.getElementsByTagName("TBODY")){if(Anchor1.getElementsByTagName("TBODY").length>0){Anchor2=Anchor1.getElementsByTagName("TBODY").item(0)}}}var sQS="";var s="";var bUpsell=false;if(Anchor2){s=THGetDepAirport(Anchor2);if(s==""){LogError("No Departure")}if(s!=""){sQS+="D="+s+"&"}s=THGetDesAirport(Anchor2);if(s==""){LogError("No Destination")}if(s!=""){sQS+="A="+s+"&"}s=THGetAirline(Anchor2);if(s==""){LogError("No Airline")}if(s!=""){sQS+="C="+s+"&"}s=THGetDate(Anchor2);if(s==""){LogError("No Date")}if(s!=""){sQS+="Dt="+s+"&CI="+s+"&"}s=THGetFlightNum(Anchor2);if(s==""){LogError("No Flight Num")}if(s!=""){sQS+=s+"&"}s=THGetHotelIDs();if(s!=""){sQS+=s;bUpsell=true}s=THGetReturnDate();if(s!=""){sQS+="R="+s+"&CO="+s+"&"}}s=THGetEAPID();if(s!=""){sQS+="eapid="+s+"&"}sQS+=THGetTravelers();if(sQS.length>0){var DelScript=document.createElement("script");DelScript.charset="utf-8";var thsrn=Math.floor(Math.random()*1000000);DelScript.src=iProtocol+"://"+th_domain+"/Offers/Delivery/FlightSummary.aspx?thrn="+thsrn+"&pgID="+THPageID+"&"+sQS;if(document.getElementById("altScript")){document.getElementById("altScript").value=DelScript.src}document.body.insertBefore(DelScript,document.body.firstChild);if(bUpsell){DelScript=document.createElement("script");DelScript.charset="utf-8";var thsrn=Math.floor(Math.random()*1000000);DelScript.src=iProtocol+"://"+th_domain+"/Package/Delivery/Search.aspx?Stage=9&thrn="+thsrn+"&pgID="+THPageID+"&"+sQS;document.body.insertBefore(DelScript,document.body.firstChild)}}}catch(er){LogError("GeneralScraping:"+er)}}if(navigator.cookieEnabled){ScrapeFlight()}}catch(er){};